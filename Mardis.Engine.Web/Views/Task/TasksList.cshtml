@model IEnumerable<Mardis.Engine.Web.ViewModel.TaskViewModels.ListTaskViewModel>
@{
    ViewData["Menu"] = "Listado";
    ViewData["Title"] = "";
    ViewData["Description"] = "";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .circle-icon.circle-bricky {
        background-color: #605ca8 !important;
    }
</style>
@section buttons{

    <div class="row">
        <div class="col-sm-2 pull-right">
        </div>

        <div class="col-sm-2 pull-right">
            <div class="btn-group">
                <button data-toggle="dropdown" class="btn bg-purple btn-flat margin dropdown-toggle">
                    <i class="clip-list-5"></i>
                    Opciones
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    
                    <li>
                        <a href="#" id="btnDelete" onclick="MasivePdf();">
                            <i class="clip-minus-circle-2"></i> Imprimir PDF
                        </a>
                    </li>
                
                </ul>
            </div>
        </div>
    </div>
    <br />
}

@section filters{}

    <section class="content">
        <div class="row">
            <div class="col-sm-1">
                <div class="core-box pull-right">
                    <div class="heading">
                        <i class="clip-picassa circle-icon circle-bricky"></i>

                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <p>
                    <br />
                    Seleccione el registro que desea aggregar a la impresión de PDF. <br />
                    Recuerde que la generación del PDF dependeran del número de encuestas que ha seleccionado<br />
                </p>
            </div>
        </div>
        <div class="row">
            <div class="box box-solidbox box-solid">
                <div class="box-header with-border">
                    <h3 class="box-title">Listado de Encuestas</h3>

                </div>
                <div class="box-body">
                    <div class="col-md-12">
                        <div class="box box-solidbox box-solid">
                            <div id="DatosTabla" class="col-xs-10 col-md-10 col-lg-6 " style="overflow: auto; width: 100%; left: 0%;">
                                <table id="table-task" class="table table-striped table-hover mailbox-messages">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Codigo</th>
                                            <th>Nombre</th>
                                            <th>Direción</th>
                                            <th>Cuidad</th>

                                            <th>Tipologia</th>

                                            <th>Estado</th>
                                            <th>Fecha</th>
                                            <th>Encuestador</th>
                                            <th>Ruta</th>
                                            <th>Observación</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.ToList())
                                        {
                                        <tr id="@("row" + item.Id)">
                                            <td>
                                                <!--Control de cambios-->
                                                <input id="@item.Id" onchange="SelectItem(this);" type="checkbox" value="@item.Id" />
                                            </td>
                                            <td>@( item.BranchMardisCode)</td>
                                            <td>@( item.BranchName)</td>
                                            <td>@( item.Street)</td>
                                            <td>@( item.city)</td>
                                            <td>@( item.TypeBussiness)</td>
                                            <td>@( item.status)</td>
                                            <td>@( item.Street)</td>
                                            <td>@( item.NamePollster)</td>
                                            <td>@( item.Route)</td>
                                            <td>@( item.comment)</td>

                                        </tr>

                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </section>
@section Scripts {

    <script src="~/js/viewModel/EncuestadorView.js"></script>
    <script type="text/javascript">



        generarTabla()


     function generarTabla() {

         table = $('#table-task').dataTable({
                "language": {
                    "url": "@Url.Content("~/js/latin.json")"
                 },
                 "pageLength": 15


            }
                );
            }

            var selectedItems = [];

            function SelectItem(element) {
                var id = element.id;
                if (element.checked) {
                    selectedItems.push(id);
                } else {
                    selectedItems.forEach(function (item, i) {
                        if (item === id) {
                            selectedItems.splice(i, 1);
                        }
                    });
                }


                console.log(selectedItems)
        }


        function MasivePdf() {

     
            $.blockUI({ message: "Generando el PDF..." });
            $.ajax({
                url: '/task/PdfMasive',
                type: "POST",
                content: "application/json; charset=utf-8",
                data: {
                    ids: selectedItems

                },
                success: function (data) {
                    if (data != '' || data != null) {

                        location.href = data;
                        $.unblockUI();
                    } else {
                        bootbox.alert("Existió un problema, comuníquese con el administrador");
                        $.unblockUI();
                    }
                },

                error: function () {

                    $.unblockUI();
                }
                //,
                //async: true, // La petici�n es s�ncrona
            });
            }

    </script>

}
